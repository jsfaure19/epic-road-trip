# frozen_string_literal: true

require 'rails_helper'

RSpec.describe GetLatLong do
  let!(:search_string) { 'auch' }
  let!(:response_search) {
    "[{\"place_id\":281813843,\"licence\":\"Data \xC2\xA9 OpenStreetMap contributors, ODbL 1.0. https://osm.org/copyright\",\"osm_type\":\"relation\",\"osm_id\":128184,\"boundingbox\":[\"43.6171942\",\"43.7077242\",\"0.4860406\",\"0.6470905\"],\"lat\":\"43.6463558\",\"lon\":\"0.5850507\",\"display_name\":\"Auch, Gers, Occitanie, France m\xC3\xA9tropolitaine, 32000, France\",\"place_rank\":16,\"category\":\"boundary\",\"type\":\"administrative\",\"importance\":0.6649207498231539,\"icon\":\"https://nominatim.openstreetmap.org/ui/mapicons/poi_boundary_administrative.p.20.png\"},{\"place_id\":282192140,\"licence\":\"Data \xC2\xA9 OpenStreetMap contributors, ODbL 1.0. https://osm.org/copyright\",\"osm_type\":\"relation\",\"osm_id\":1649154,\"boundingbox\":[\"43.3627397\",\"43.858539\",\"0.1378404\",\"1.2032681\"],\"lat\":\"43.61063045\",\"lon\":\"0.8474013440201327\",\"display_name\":\"Auch, Gers, Occitanie, France m\xC3\xA9tropolitaine, France\",\"place_rank\":14,\"category\":\"boundary\",\"type\":\"administrative\",\"importance\":0.4570373282821678,\"icon\":\"https://nominatim.openstreetmap.org/ui/mapicons/poi_boundary_administrative.p.20.png\"},{\"place_id\":100962641,\"licence\":\"Data \xC2\xA9 OpenStreetMap contributors, ODbL 1.0. https://osm.org/copyright\",\"osm_type\":\"way\",\"osm_id\":14801485,\"boundingbox\":[\"43.6248044\",\"43.6260538\",\"1.4139801\",\"1.4189878\"],\"lat\":\"43.6252315\",\"lon\":\"1.4165328\",\"display_name\":\"Blagnac, Auch, Sept Deniers - Ginestous, Toulouse Nord, Toulouse, Haute-Garonne, Occitanie, France m\xC3\xA9tropolitaine, 31200, France\",\"place_rank\":27,\"category\":\"highway\",\"type\":\"motorway_link\",\"importance\":0.17499999999999996},{\"place_id\":106795490,\"licence\":\"Data \xC2\xA9 OpenStreetMap contributors, ODbL 1.0. https://osm.org/copyright\",\"osm_type\":\"way\",\"osm_id\":24625341,\"boundingbox\":[\"43.6054447\",\"43.6059221\",\"1.4036362\",\"1.4047266\"],\"lat\":\"43.6058037\",\"lon\":\"1.404398\",\"display_name\":\"Blagnac, Auch, Ar\xC3\xA8nes Romaines - Saint-Martin-du-Touch, Toulouse Ouest, Toulouse, Haute-Garonne, Occitanie, France m\xC3\xA9tropolitaine, 31300, France\",\"place_rank\":27,\"category\":\"highway\",\"type\":\"motorway_link\",\"importance\":0.17499999999999996},{\"place_id\":48956172,\"licence\":\"Data \xC2\xA9 OpenStreetMap contributors, ODbL 1.0. https://osm.org/copyright\",\"osm_type\":\"node\",\"osm_id\":4197199099,\"boundingbox\":[\"43.6422899\",\"43.6522899\",\"0.5919312\",\"0.6019312\"],\"lat\":\"43.6472899\",\"lon\":\"0.5969312\",\"display_name\":\"Auch, Avenue Sambre et Meuse, Auch, Gers, Occitanie, France m\xC3\xA9tropolitaine, 32000, France\",\"place_rank\":30,\"category\":\"railway\",\"type\":\"station\",\"importance\":0.101,\"icon\":\"https://nominatim.openstreetmap.org/ui/mapicons/transport_train_station2.p.20.png\"},{\"place_id\":6330081,\"licence\":\"Data \xC2\xA9 OpenStreetMap contributors, ODbL 1.0. https://osm.org/copyright\",\"osm_type\":\"node\",\"osm_id\":779169400,\"boundingbox\":[\"43.6472436\",\"43.6473436\",\"0.5968396\",\"0.5969396\"],\"lat\":\"43.6472936\",\"lon\":\"0.5968896\",\"display_name\":\"Auch, Avenue Sambre et Meuse, Auch, Gers, Occitanie, France m\xC3\xA9tropolitaine, 32000, France\",\"place_rank\":30,\"category\":\"railway\",\"type\":\"stop\",\"importance\":0.101},{\"place_id\":340837715,\"licence\":\"Data \xC2\xA9 OpenStreetMap contributors, ODbL 1.0. https://osm.org/copyright\",\"osm_type\":\"node\",\"osm_id\":5543232509,\"boundingbox\":[\"43.6042238\",\"43.6043238\",\"1.4018369\",\"1.4019369\"],\"lat\":\"43.6042738\",\"lon\":\"1.4018869\",\"display_name\":\"Blagnac, Auch, A 620, Fontaine Bayonne - Cartoucherie, Toulouse Rive Gauche, Toulouse, Haute-Garonne, Occitanie, France m\xC3\xA9tropolitaine, 31300, France\",\"place_rank\":30,\"category\":\"highway\",\"type\":\"motorway_junction\",\"importance\":0.101},{\"place_id\":79528790,\"licence\":\"Data \xC2\xA9 OpenStreetMap contributors, ODbL 1.0. https://osm.org/copyright\",\"osm_type\":\"node\",\"osm_id\":7554216995,\"boundingbox\":[\"48.1929737\",\"48.1930737\",\"11.5825023\",\"11.5826023\"],\"lat\":\"48.1930237\",\"lon\":\"11.5825523\",\"display_name\":\"Auch, Hufelandstra\xC3\x9Fe, Siedlung Kaltherberge, Am Hart, Milbertshofen-Am Hart, M\xC3\xBCnchen, Bayern, 80939, Deutschland\",\"place_rank\":30,\"category\":\"shop\",\"type\":\"car\",\"importance\":0.101,\"icon\":\"https://nominatim.openstreetmap.org/ui/mapicons/shopping_car.p.20.png\"},{\"place_id\":314385,\"licence\":\"Data \xC2\xA9 OpenStreetMap contributors, ODbL 1.0. https://osm.org/copyright\",\"osm_type\":\"node\",\"osm_id\":146176398,\"boundingbox\":[\"43.6263907\",\"43.6264907\",\"1.4193647\",\"1.4194647\"],\"lat\":\"43.6264407\",\"lon\":\"1.4194147\",\"display_name\":\"Blagnac, Auch, P\xC3\xA9riph\xC3\xA9rique Ext\xC3\xA9rieur, Sept Deniers - Ginestous, Toulouse Nord, Toulouse, Haute-Garonne, Occitanie, France m\xC3\xA9tropolitaine, 31200, France\",\"place_rank\":30,\"category\":\"highway\",\"type\":\"motorway_junction\",\"importance\":0.101},{\"place_id\":310740,\"licence\":\"Data \xC2\xA9 OpenStreetMap contributors, ODbL 1.0. https://osm.org/copyright\",\"osm_type\":\"node\",\"osm_id\":146086019,\"boundingbox\":[\"43.6058721\",\"43.6059721\",\"1.4046766\",\"1.4047766\"],\"lat\":\"43.6059221\",\"lon\":\"1.4047266\",\"display_name\":\"Purpan, Blagnac, Auch, A 620, Ar\xC3\xA8nes Romaines - Saint-Martin-du-Touch, Toulouse Ouest, Toulouse, Haute-Garonne, Occitanie, France m\xC3\xA9tropolitaine, 31300, France\",\"place_rank\":30,\"category\":\"highway\",\"type\":\"motorway_junction\",\"importance\":0.101}]"
  }
  describe 'search' do  
    subject { -> { described_class.search(search_string) } }
    before do
      HTTParty.should_receive(:get).with(
        "https://nominatim.openstreetmap.org/search.php?q=#{search_string}&format=jsonv2"
      ).and_return(JSON.parse(response_search))
    end
    it { is_expected.not_to raise_error }
  end
end